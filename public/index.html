<!DOCTYPE html>
<html>
<head>

</head>
<body>
<audio id="mc" controls>
    <source src="/05%20-%20Hash%20Pipe.opus" type="audio/ogg">
</audio>
<script>
    let tracks = [
        {
            name: "Drums",
            channels: 2
        },
        {
            name: "Bass",
            channels: 1
        },
        {
            name: "Guitar MG",
            channels: 1,
            pan: -100
        },
        {
            name: "Guitar JD",
            channels: 1,
            pan: +100
        },
        {
            name: "Vox MG",
            channels: 1
        },
        {
            name: "Vox JD",
            channels: 1,
            pan: +33
        }
    ];

    // add an AudioContext
    let ac = new AudioContext();

    let mcAudio = document.getElementById("mc");
    let mcSource = ac.createMediaElementSource(mcAudio);

    // TODO: would be nice to detect channel count from source.
    let splitter = ac.createChannelSplitter(8);
    splitter.channelCountMode = "explicit";
    splitter.channelInterpretation = "discrete";
    mcSource.connect(splitter);

    let c = 0;
    for (let track of tracks) {
        // Merge outputs into channels:
        let merger = ac.createChannelMerger(track.channels);
        for (let i = 0; i < track.channels; i++) {
            splitter.connect(merger, c+i, i);
        }
        c += track.channels;

        // TODO: make pan left/right gain nodes, mute, solo, etc.
        // Boost mono tracks by +3dB ?
        merger.connect(ac.destination);
    }
</script>
</body>
</html>